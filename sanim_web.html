<!DOCTYPE html>
<html>
<body bgcolor="#e6f3ff">

<video id="video1" width="1280" height="720" muted>
  <source src="vid1440.mp4" type="video/mp4">
  <source src="vid480.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>

<script src="time_stamps.js"></script>
<script>

var BACKWARD_SPEED = 2;

//stuff for backward playing
var intervalRewind;
function rewind(vid) { // button function for rewind
    intervalRewind = setInterval(function() {
       vid.playbackRate = 1.0;
       if(vid.currentTime == 0){
           clearInterval(intervalRewind);
           vid.pause();
       }
       else{
           vid.currentTime += -.1;
       }
    }, 100/BACKWARD_SPEED);
}

var vid = document.getElementById("video1");

var currPos = 0;
var isCurrPlaying = false;

document.onkeydown = function(e) {
    if (isCurrPlaying) {
        console.log('still playing; wait until transition finishes');
        return;
    }
    isCurrPlaying = true; //lock the function
    vid.currentTime = timeStamps[currPos]; //start video from the time stamp

    if (e.key == 'ArrowDown' || e.key == 'ArrowRight' || e.key == 'Space') {
        if (currPos == timeStamps.length-1) {
            isCurrPlaying = false;
            return;
        }
        let duration = timeStamps[currPos+1] - timeStamps[currPos];
        vid.play();
        setTimeout(function(){
            vid.pause();
            console.log('done playing',duration, 's forward from pos',currPos);
            currPos++;
            isCurrPlaying = false;
        }, duration*1000);
    } else if (e.key == 'ArrowUp' || e.key == 'ArrowLeft') {
        if (currPos == 0) {
            isCurrPlaying = false;
            return;
        }
        let duration = timeStamps[currPos] - timeStamps[currPos-1];
        rewind(vid);
        setTimeout(function(){
            clearInterval(intervalRewind);
            vid.pause();
            console.log('done playing',duration,'s backwards from pos',currPos);
            currPos--;
            isCurrPlaying = false;
        }, duration*1000/BACKWARD_SPEED);
    }

}

</script>

</body>
</html>
